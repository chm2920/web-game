<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Websocket</title>
<script>
var socket;
function $(v){return document.getElementById(v);}
function addMsg(msg){
	$('content').textContent += '> ' + msg + '\n';
}

function onConnected(){
	addMsg('connection opened');
}
function onClosed(){
	addMsg('connection closed');
}

function bind(){
	$('send').onclick = function(){
		var data = {
			'data': $('input').value()
		};
		socket.send(JSON.stringify(data));
	};
}

window.onload = function(){
	var server = 'localhost';
	var port = '27688';
	socket = new WebSocket('ws://' + server + ':' + port + '/', 'test');
	socket.onopen = function(e) {
		onConnected();
		var data = {
			'type': 'req',
			'action': 'users'
		};
		socket.send(JSON.stringify(data));
	}
	socket.onclose = function(e) {
		onClosed();
	}
	socket.onmessage = function(e) {
		addMsg(e.data);
	}
}
</script>
</head>

<body>
<div style="width:400px;text-align:center;margin:0 auto;">
<p>
	<textarea id="content" style="width:200px;height:400px;"></textarea>
</p>
<p>
	<input type="text" id="input" />
	<input type="submit" id="send" value="Send" />
</p>
</div>
</body>
</html>
